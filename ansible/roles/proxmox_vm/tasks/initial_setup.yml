---
# Initial VM setup tasks
- name: Wait for SSH to be available
  wait_for_connection:
    connect_timeout: "{{ vm_connect_timeout }}"
    sleep: "{{ vm_connect_sleep }}"
    delay: "{{ vm_connect_delay }}"
    timeout: "{{ vm_ssh_timeout }}"

- name: Gather system facts
  setup:

- name: Update package cache
  apt:
    update_cache: yes
    cache_valid_time: 3600
  when: ansible_facts['os_family'] == "Debian"

- name: Install essential packages
  apt:
    name: "{{ essential_packages }}"
    state: present
    update_cache: yes
  when: ansible_facts['os_family'] == "Debian"