# Corosync Cluster Configuration
# Generated by Ansible - DO NOT EDIT MANUALLY
#
# Two-node HA cluster configuration for nginx load balancer

# Totem Protocol Configuration
totem {
    version: 2
    cluster_name: {{ cluster_name }}
    transport: {{ corosync_config.transport }}

    # Token timeouts - how long before a node is considered dead
    token: {{ corosync_config.token_timeout }}
    token_retransmits_before_loss_const: 10

    # Consensus timeout
    consensus: 1200

    # Interface configuration
    interface {
        ringnumber: 0
        bindnetaddr: 192.168.10.0
        broadcast: yes
        mcastport: 5405
    }
}

# Logging Configuration
logging {
    to_logfile: yes
    logfile: /var/log/corosync/corosync.log
    to_syslog: yes
    timestamp: on
}

# Quorum Configuration
# For 2-node clusters, we need special quorum settings
quorum {
    provider: corosync_votequorum
    expected_votes: {{ corosync_config.expected_votes }}
    two_node: {{ corosync_config.two_node }}
}

# Node List
# Explicitly define both cluster nodes
nodelist {
{% for host in groups['nginx_lb'] %}
    node {
        ring0_addr: {{ hostvars[host]['ansible_host'] }}
        name: {{ host }}
        nodeid: {{ loop.index }}
    }
{% endfor %}
}
