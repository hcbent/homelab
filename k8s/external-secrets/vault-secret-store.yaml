---
# ServiceAccount for Vault authentication
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vault-auth
  namespace: external-secrets-system
---
# SecretStore for Vault backend
# This uses token-based authentication initially. For production, consider Kubernetes auth.
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: vault-backend
spec:
  provider:
    vault:
      server: "https://192.168.10.101:8200"
      path: "secret"
      version: "v2"
      # Use token authentication (simplest for initial setup)
      # For production, configure Kubernetes auth method in Vault
      auth:
        tokenSecretRef:
          name: "vault-token"
          namespace: "external-secrets-system"
          key: "token"
      # Skip TLS verification if using self-signed certs
      # For production, provide proper CA certificate
      caBundle: ""
      # Skip TLS verification (use only if you have self-signed certs and understand the risks)
      # Remove this in production with proper TLS setup
---
# Example: Secret containing Vault token
# Create this manually with: kubectl create secret generic vault-token -n external-secrets-system --from-literal=token=<your-vault-token>
# For production, use Kubernetes auth method instead of token
apiVersion: v1
kind: Secret
metadata:
  name: vault-token
  namespace: external-secrets-system
type: Opaque
stringData:
  # Replace this with your actual Vault token
  # This should be created with appropriate policies (e.g., apps policy)
  # Command to create: kubectl create secret generic vault-token -n external-secrets-system --from-literal=token=<your-token>
  token: "REPLACE_WITH_YOUR_VAULT_TOKEN"
