# ArgoCD Helm values for GitOps deployment
# Reference: https://argo-cd.readthedocs.io/

global:
  image:
    repository: quay.io/argoproj/argocd
    tag: ""  # Uses chart appVersion if empty

# ArgoCD server configuration
server:
  replicas: 1
  service:
    type: LoadBalancer  # Uses MetalLB for external access
    # Optionally specify a LoadBalancer IP
    # loadBalancerIP: "192.168.100.20"

  # Server configuration
  config:
    # Repository credentials (configure via UI or CLI after deployment)
    repositories: |
      - type: git
        url: https://github.com/wortmanb/homelab.git
      - type: helm
        name: stable
        url: https://charts.helm.sh/stable
      - type: helm
        name: argo
        url: https://argoproj.github.io/argo-helm

  # Ingress configuration (if using Ingress instead of LoadBalancer)
  ingress:
    enabled: false
    # Enable this if you prefer Ingress over LoadBalancer
    # annotations:
    #   cert-manager.io/cluster-issuer: ca-cluster-issuer
    #   traefik.ingress.kubernetes.io/router.entrypoints: websecure
    # hosts:
    #   - argocd.lab.thewortmans.org
    # tls:
    #   - secretName: argocd-tls
    #     hosts:
    #       - argocd.lab.thewortmans.org

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Repository server
repoServer:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Application controller
controller:
  replicas: 1
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

# Redis for caching
redis:
  enabled: true
  resources:
    requests:
      cpu: 100m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

# Dex for SSO (disabled for homelab)
dex:
  enabled: false

# Notifications controller
notifications:
  enabled: false
  # Enable for Slack/Email notifications
  # argocdUrl: https://argocd.lab.thewortmans.org

# ApplicationSet controller
applicationSet:
  enabled: true
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# RBAC configuration
configs:
  rbac:
    policy.default: role:readonly
    policy.csv: |
      # Admin users (add your users here)
      p, role:org-admin, applications, *, */*, allow
      p, role:org-admin, clusters, get, *, allow
      p, role:org-admin, repositories, *, *, allow
      p, role:org-admin, logs, get, *, allow
      g, admin, role:admin

  # Secret management
  secret:
    # If you want ArgoCD to generate a random admin password, leave this empty
    # Otherwise, provide a bcrypt hash of your desired password
    argocdServerAdminPassword: ""
    # Example: bcrypt hash of "homelab123"
    # argocdServerAdminPassword: "$2a$10$..."

# Projects
projects:
  - name: default
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    description: Default project
    sourceRepos:
      - '*'
    destinations:
      - namespace: '*'
        server: https://kubernetes.default.svc
    clusterResourceWhitelist:
      - group: '*'
        kind: '*'
    orphanedResources:
      warn: false

# Initial repositories (can also be added via UI/CLI)
# configs:
#   repositories:
#     homelab:
#       url: git@github.com:wortmanb/homelab.git
#       sshPrivateKeySecret:
#         name: argocd-repo-creds
#         key: sshPrivateKey
