# CrowdSec Helm Values
# https://github.com/crowdsecurity/helm-charts

# Container runtime - kubespray uses containerd
container_runtime: containerd

# LAPI (Local API) configuration
lapi:
  enabled: true
  replicas: 1

  # Persistent storage disabled until iSCSI is fixed
  # TODO: Enable storage once TrueNAS connectivity issues are resolved
  persistentVolume:
    data:
      enabled: false
    config:
      enabled: false

  # Resources
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

  # Environment variables
  env:
    - name: ENROLL_INSTANCE_NAME
      value: "homelab-k8s"


# Agent configuration - runs as DaemonSet on all nodes
agent:
  enabled: true

  # Pod log acquisition - monitor specific namespaces
  acquisition:
    - namespace: media
      podName: "*"
      program: ""
      poll_without_inotify: true
    - namespace: nginx-proxy-manager
      podName: "*"
      program: nginx
      poll_without_inotify: true

  # Resources per agent
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  # Tolerations to run on all nodes including control-plane
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule

# Custom configuration - these are objects not arrays
config:
  parsers:
    s02-enrich: {}
  scenarios: {}
  postoverflows:
    s01-whitelist: {}

# Metrics for Prometheus
metrics:
  enabled: true
  serviceMonitor:
    enabled: false
