vim setup.sh
ls /usr/bin/zsh
ls /bin/zsh
ls -l /usr/bin/zsh
ls -l /bin/zsh
sudo apt-get update && sudo apt-get install -y nfs-common
mkdir test
telnet 192.168.1.230 2049
mount -t nfs 192.168.1.230:/volume1/k8s test
systemctl status firewalld
apt list | grep nfs
apt list --installed | grep nfs
apt -y install nfs-tools
sudo apt -y install nfs-tools
sudo apt install nfs-kernel-server
kubectl get pods --all-namespaces -o wide
kubectl get pods --all-namespaces -o wide | grep kube01 | wc -l
kubectl get pods --all-namespaces -o wide | grep kube02 | wc -l
kubectl get pods --all-namespaces -o wide | grep kube03 | wc -l
kubectl get pods --all-namespaces -o wide | grep km01 | wc -l
kubectl get pods --all-namespaces -o wide | grep km02 | wc -l
sudo mount -t nfs 192.168.1.230:/volume1/k8s test
ls test
umount test
sudo umount test
kubectl get pvc
k drain km01
k drain km01 --ignore-daemonsets
sudo apt update && sudo apt -y upgrade
sudo k get nodes
sudo kubectl get nodes
k uncordon km01
sudo poweroff
sudo systemctl status kubectl
curl -fsSL https://tailscale.com/install.sh | sh && sudo tailscale up --auth-key=tskey-auth-kSHrNdxFak11CNTRL-NXjbrWWosEMDh6omj7QKFMJfg6Tz56Dv
sudo tailscale up
sudo -i
kubeadm versioun
kubeadm versionn
kubeadm version
uptime
sudo apt-mark release kubeadm kubelet kubectl
sudo apt-mark delete kubeadm kubelet kubectl
sudo apt-mark --help
sudo apt-mark unhold kubeadm kubelet kubectl
sudo apt -y upgrade
sudo apt-mark hold kubeadm kubelet kubectl
cat /etc/hosts
kubectl version
k get nodes
ssh km01
scp km01:/etc/kubernetes/pki/apiserver.* .
sudo scp km01:/etc/kubernetes/pki/apiserver.* .
vim /etc/kubernetes/pki/apiserver.crt
sudo vim /etc/kubernetes/pki/apiserver.crt
sudo vim /etc/kubernetes/pki/apiserver.key
sudo openssl x509 -in /etc/kubernetes/pki/apiserver.crt -text -noout | grep -A1 "Subject Alternative Name"
k get pods
k delete pod kube-apiserver-km02
k delete pod kube-apiserver-km02 -n kube-system
k get pods -n kube-system | grep apiserver
k get pods -n kube-system | grep apiserver -w
ip a | grep 192
tar xf pki.tgz
sudo cp etc/kubernetes/pki/apiserver.* /etc/kubernetes/pki
sudo openssl x509 -in /etc/kubernetes/pki/apiserver.crt -text -noout | grep -A2 "Subject Alternative Name"
sudo systemctl restart kubelet
cat .kube/config | grep k8s
host 192.168.10.50
host budget.thewortmans.org
sudo tee /etc/multipath.conf <<-'EOF'\
defaults {\
    user_friendly_names yes\
    find_multipaths yes\
}\
EOF\
\
sudo systemctl enable multipath-tools.service\
sudo service multipath-tools restart\
sudo systemctl enable open-iscsi.service\
sudo service open-iscsi start
kubectl exec -n kube-system etcd-km02 -- etcdctl \\
  --endpoints=https://192.168.10.100:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\
  --key=/etc/kubernetes/pki/etcd/healthcheck-client.key \\
  snapshot save ~/backup.db
kubectl exec -n kube-system etcd-km02 -- etcdctl \\
  --endpoints=https://192.168.10.100:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\
  --key=/etc/kubernetes/pki/etcd/healthcheck-client.key \\
  snapshot save /home/bret/backup.db
kubectl exec -n kube-system etcd-km02 -- etcdctl \\
  --endpoints=https://192.168.10.100:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\
  --key=/etc/kubernetes/pki/etcd/healthcheck-client.key \\
  snapshot save /opt/backup.db
kubectl exec -n kube-system etcd-km02 -- etcdctl \\
  --endpoints=https://192.168.10.100:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\
  --key=/etc/kubernetes/pki/etcd/healthcheck-client.key \\
  snapshot save backup.db
pwd
find . -type f -name backup.db
find / -type f -name backup.db
sudo find / -type f -name backup.db 2> /dev/null
kubeadm token create --print-join-command --certificate-key $(kubeadm init phase upload-certs --upload-certs | tail -n 1)
ls -ll /etc/kubernetes/admin.conf
sudo kubeadm token create --print-join-command --certificate-key $(kubeadm init phase upload-certs --upload-certs | tail -n 1)
sudo kubeadm token create --print-join-command --certificate-key dd134e7e734a24809f64655ce2f493c3e789ccb1eec573b0e58c99573539aad6
kubectl get pods -n kube-system -l component=kube-apiserver -o wide\
kubectl logs -n kube-system kube-apiserver-km01
kubectl get nodes -o wide\
kubectl describe node km01
openssl x509 -in /etc/kubernetes/pki/etcd/server.crt -text -noout
kubectl get nodes -o wide
ls -l /etc/kubernetes/pki
ls -l /etc/kubernetes/pki -.tr
ls -l /etc/kubernetes/pki -ltr
kubectl delete pod -n kube-system kube-apiserver-km01
kubectl delete node km01
host cp.lab.thewortmans.org
sudo kubeadm init phase upload-certs --upload-certs
sudo vim /etc/kubernetes/admin.conf
cd git/dotfiles
ls
rm -rf lazygit*
git diff ssh
git stash
git pull
cd
cd .ssh
cd ../git/dotfiles/ssh/.ssh/
ls -ltr
chmnod 0600 *
chmod 0600 *
git status
ssh 192.168.10.100 curl -k https://cp.lab.thewortmans.org:6443
kuberctl get pods -n kube-system -l component=kube-apiserver -o wide
kubectl get pods -n kube-system -l component=kube-apiserver -o wide
ssh <km02-ip> sudo kubectl --kubeconfig=/etc/kubernetes/admin.conf get pods -n kube-system -l component=kube-apiserver -o wide
sudo kubectl --kubeconfig=/etc/kubernetes/admin.conf get pods -n kube-system -l component=kube-apiserver -o wide
sudo crictl logs kube-apiserver-km02\

sudo crictl ps -a
sudo crictl ps -a | grep kube-apiserver
sudo crictl logs kube-apiserver-km02
sudo mv /etc/kubernetes/manifests/kube-apiserver.yaml /tmp/ && sleep 5 && sudo mv /tmp/kube-apiserver.yaml /etc/kubernetes/manifests/
sudo crictl pls | grep kube-apiserver
sudo crictl ps | grep kube-apiserver
sudo systemctl status kubelet
sudo journalctl -u kubelet -f
crictl ps
sudo crictl ps
sudo vim /etc/kubernetes/manifests/kube-apiserver.yaml
[200~ssh <km02-ip> sudo kubectl exec -n kube-system etcd-<running-node> -- etcdctl \\
  --endpoints=https://<km02-ip>:2379,https://192.168.10.202:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\
  --key=/etc/kubernetes/pki/etcd/healthcheck-client.key \ 
sudo kubectl exec -n kube-system etcd-<running-node> -- etcdctl \\
  --endpoints=https://192.168.10.100:2379,https://192.168.10.202:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\
  --key=/etc/kubernetes/pki/etcd/healthcheck-client.key \\
  endpoint health
sudo kubectl exec -n kube-system etcd-km02 -- etcdctl \\
  --endpoints=https://192.168.10.100:2379,https://192.168.10.202:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\
  --key=/etc/kubernetes/pki/etcd/healthcheck-client.key \\
  endpoint health
crictl ps | grep etcd
sudo crictl ps | grep etcd
sudo kubectl exec -n kube-system etcd-km02 -- etcdctl \\
  --endpoints=https://192.168.10.100:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\
  --key=/etc/kubernetes/pki/etcd/healthcheck-client.key \\
  endpoint health
kubeadm join cp.lab.thewortmans.org:6443 --token v7xft0.28ustrlkuag59svs \\
        --discovery-token-ca-cert-hash sha256:9a1489b7af5f2f795f215c7022990b4d7369a67201afb5f8421f71fb83f78f19 \\
        --control-plane --certificate-key 3e82b8e06d31edbdd07ecdf3478a5cfce566f9f2684c8af022a4929a87a4f265
sudo kubeadm join cp.lab.thewortmans.org:6443 --token v7xft0.28ustrlkuag59svs \\
        --discovery-token-ca-cert-hash sha256:9a1489b7af5f2f795f215c7022990b4d7369a67201afb5f8421f71fb83f78f19 \\
        --control-plane --certificate-key 3e82b8e06d31edbdd07ecdf3478a5cfce566f9f2684c8af022a4929a87a4f265
